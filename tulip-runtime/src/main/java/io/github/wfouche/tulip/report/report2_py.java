package io.github.wfouche.tulip.report;

/// usr/bin/env jbang "$0" "$@" ; exit $?

// spotless:off
//DEPS com.google.code.gson:gson:2.11.0
//DEPS org.hdrhistogram:HdrHistogram:2.2.2
//DEPS org.python:jython-standalone:2.7.4
//JAVA 21
// spotless:on

import java.util.Base64;
import org.python.util.PythonInterpreter;

public class report2_py {

  public static String mainScriptTextBase64 =
      "ZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBwcmludF9mdW5jdGlvbgppbXBvcnQganNvbgppbXBvcnQgc3lzCmltcG9ydCBjb20uZ29vZ2xlLmdzb24uSnNvblBhcnNlciBhcyBKc29uUGFyc2VyCmltcG9ydCBvcwpmcm9tIGNvbGxlY3Rpb25zIGltcG9ydCBPcmRlcmVkRGljdAoKIyAvLy8gamJhbmcKIyByZXF1aXJlcy1qeXRob24gPSAiPT0yLjcuNCIKIyByZXF1aXJlcy1qYXZhID0gIj49MjEiCiMgZGVwZW5kZW5jaWVzID0gWwojICAgImNvbS5nb29nbGUuY29kZS5nc29uOmdzb246Mi4xMS4wIiwKIyAgICJvcmcuaGRyaGlzdG9ncmFtOkhkckhpc3RvZ3JhbToyLjIuMiIKIyBdCiMgW3B5dGhvbi1qdm1dCiMgICBkZWJ1ZyA9IGZhbHNlCiMgLy8vCgpoZWFkZXIgPSAnJyc9IF9fREVTQ1JJUFRJT05fXwo6dG9jOiBsZWZ0CjpzZWN0bnVtczoKOmRpYWdyYW0tc2VydmVyLXVybDogaHR0cHM6Ly9rcm9raS5pby8KOmRpYWdyYW0tc2VydmVyLXR5cGU6IGtyb2tpX2lvCgpGaWxlbmFtZTo6CiAgX19DT05GSUdfRklMRU5BTUVfXwoKPT0gQWN0aW9ucwoKWyVoZWFkZXIsY29scz0iMWEsNGEiXQp8PT09CnwgaWQgfCB2YWx1ZQonJycKCmRlZiBjcmVhdGVSZXBvcnQoZmlsZW5hbWUpOgoKICAgIGRlZiBwcmludGYocyk6CiAgICAgICAgcmVwb3J0X2ZoLndyaXRlKHMpCgogICAgZGVmIGFjdGlvbk5hbWUocyk6CiAgICAgICAgcmV0dXJuIHMuc3BsaXQoIiwiKVswXS5zdHJpcCgpCgogICAgZGVmIGFjdGlvbkRlc2Mocyk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gcy5zcGxpdCgiLCIpWzFdLnN0cmlwKCkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBnZW5lcmF0ZV90YWJsZTEoZSk6CiAgICAgICAgcHJpbnRmKCJ8ICoiICsgZSArICIqXG4iKQogICAgICAgIHByaW50ZigifFxuIikKICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDNhIl1cbicpCiAgICAgICAgcHJpbnRmKCchPT09XG4nKQogICAgICAgIHByaW50ZignISBpZCAhIHZhbHVlIFxuJykKICAgICAgICBmb3IgayBpbiBqYlsnYWN0aW9ucyddW2VdLmtleXMoKToKICAgICAgICAgICAgcHJpbnRmKCchIConICsgayArICcqICcpCiAgICAgICAgICAgIHByaW50ZignISAnICsgc3RyKGpiWydhY3Rpb25zJ11bZV1ba10pICsgJ1xuJykKICAgICAgICBwcmludGYoJyE9PT1cbicpCgogICAgZGVmIGdlbmVyYXRlX3RhYmxlMihlKToKICAgICAgICBwcmludGYoInwgKiIgKyBlICsgIipcbiIpCiAgICAgICAgcHJpbnRmKCJ8XG4iKQogICAgICAgIHByaW50ZignWyVoZWFkZXIsY29scz0iMmEsMmEsNGEiXVxuJykKICAgICAgICBwcmludGYoJyE9PT1cbicpCiAgICAgICAgcHJpbnRmKCchIGlkICEgdmFsdWUgISBkZXNjcmlwdGlvblxuJykKICAgICAgICBmb3IgayBpbiBqYlsnYWN0aW9ucyddW2VdLmtleXMoKToKICAgICAgICAgICAgcHJpbnRmKCchIConICsgayArICcqICcpCiAgICAgICAgICAgIHByaW50ZignISAnICsgYWN0aW9uTmFtZShzdHIoamJbJ2FjdGlvbnMnXVtlXVtrXSkpKQogICAgICAgICAgICBwcmludGYoJyEgJyArIGFjdGlvbkRlc2Moc3RyKGpiWydhY3Rpb25zJ11bZV1ba10pKSArICdcbicpCiAgICAgICAgcHJpbnRmKCchPT09XG4nKQoKICAgIGRlZiBnZW5lcmF0ZV93b3JrZmxvdygpOgogICAgICAgIGRpYWdJZCA9IC0xCiAgICAgICAgZGVmIG5hbWVfdG9faWQocyk6CiAgICAgICAgICAgIGlmIHMgaW4gJy0nOgogICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgcmV0dXJuIGludChzKQogICAgICAgIGRlZiBhY3Rpb25fbmFtZShzKToKICAgICAgICAgICAgaWYgcyBpbiBqYlsnYWN0aW9ucyddWyd1c2VyX2FjdGlvbnMnXS5rZXlzKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uTmFtZShqYlsnYWN0aW9ucyddWyd1c2VyX2FjdGlvbnMnXVtzXSkKICAgICAgICAgICAgcmV0dXJuICc8dW5rbm93bj4nCgogICAgICAgICNwcmludChqYi5rZXlzKCkpCiAgICAgICAgI3ByaW50KGpiWyJ3b3JrZmxvd3MiXS5rZXlzKCkpCiAgICAgICAgZm9yIHduIGluIGpiWyJ3b3JrZmxvd3MiXS5rZXlzKCk6CiAgICAgICAgICAgIGRpYWdJZCArPSAxCiAgICAgICAgICAgIHByaW50ZigiXG4iKQogICAgICAgICAgICBwcmludGYoIltbJXNdXVxuIiUod24pKQogICAgICAgICAgICBwcmludGYoIj09PSAiICsgIiVzXG4iJSh3bikpCiAgICAgICAgICAgIHByaW50ZigiXG4iKQogICAgICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDFhIl1cbicpCiAgICAgICAgICAgIHByaW50ZignfD09PVxuJykKICAgICAgICAgICAgcHJpbnRmKCd8IFdvcmtmbG93IERpYWdyYW0gfCBTcGVjaWZpY2F0aW9uXG4nKQogICAgICAgICAgICBwcmludGYoJ3wnKQogICAgICAgICAgICBwcmludGYoIltwbGFudHVtbCx3ZmQlZCxzdmddIiUoZGlhZ0lkKSArICdcbicpCiAgICAgICAgICAgIHByaW50ZignLS0tLVxuJykKICAgICAgICAgICAgcHJpbnRmKCdAc3RhcnR1bWxcbicpCiAgICAgICAgICAgICNwcmludGYoJ3RpdGxlICVzXG4nJSh3bikpCiAgICAgICAgICAgIGZvciBzbmFtZSBpbiBqYlsnd29ya2Zsb3dzJ11bd25dLmtleXMoKToKICAgICAgICAgICAgICAgIGlmIHNuYW1lIGluIFsnLSddOgogICAgICAgICAgICAgICAgICAgIHByaW50Zignc3RhdGUgIi0iIGFzIEEwXG4nKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBzaWQgPSBpbnQoc25hbWUpCiAgICAgICAgICAgICAgICBwcmludGYoJ3N0YXRlICJBY3Rpb24gJWQiIGFzIEElZFxuJyUoc2lkLHNpZCkpCiAgICAgICAgICAgICAgICBwcmludGYoJ0ElZDogPCVzPlxuJyUoc2lkLGFjdGlvbl9uYW1lKHNuYW1lKSkpCiAgICAgICAgICAgICAgICBwcmludGYoJ1xuJykKICAgICAgICAgICAgZm9yIHNuYW1lIGluIGpiWyd3b3JrZmxvd3MnXVt3bl0ua2V5cygpOgogICAgICAgICAgICAgICAgaWYgc25hbWUgaW4gWycqJ106CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGlmIHNuYW1lIGluIFsnLSddOgogICAgICAgICAgICAgICAgICAgIG1pZCA9IDAKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbWlkID0gaW50KHNuYW1lKQogICAgICAgICAgICAgICAgZm9yIGsgaW4gamJbJ3dvcmtmbG93cyddW3duXVtzbmFtZV0ua2V5cygpOgogICAgICAgICAgICAgICAgICAgIG5pZCA9IG5hbWVfdG9faWQoaykKICAgICAgICAgICAgICAgICAgICBmdiA9IGpiWyd3b3JrZmxvd3MnXVt3bl1bc25hbWVdW2tdCiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCdBJWQgLS0+IEElZDogJS4zZlxuJyUobWlkLG5pZCxmdikpCiAgICAgICAgICAgIHByaW50ZignQGVuZHVtbFxuJykKICAgICAgICAgICAgcHJpbnRmKCctLS0tXG4nKQogICAgICAgICAgICBwcmludGYoJ3wgXG4nKQogICAgICAgICAgICBwcmludGYoJ1tzb3VyY2UsanNvbl1cbicpCiAgICAgICAgICAgIHByaW50ZignLS0tLVxuJykKICAgICAgICAgICAgcHJpbnRmKCclc1xuJyUoanNvbi5kdW1wcyhqYlsnd29ya2Zsb3dzJ11bd25dLCBpbmRlbnQ9NCkpKQogICAgICAgICAgICBwcmludGYoJy0tLS1cbicpCiAgICAgICAgICAgIHByaW50ZignfD09PVxuJykKCiAgICAjcHJpbnQoIlxuQ29uZmlnIGZpbGVuYW1lID0gIiArIGZpbGVuYW1lKQoKICAgICMgcmVwb3J0IGRpcgogICAgcmVwb3J0X2RpciA9ICIuIgogICAgaWYgb3MucGF0aC5pc2RpcigiYnVpbGQvcmVwb3J0cy90dWxpcCIpOgogICAgICAgIHJlcG9ydF9kaXIgPSAiYnVpbGQvcmVwb3J0cy90dWxpcCIKCiAgICAjIC5qc29uYyAtPiAuYWRvYwogICAgZl9leHQgPSBvcy5wYXRoLnNwbGl0ZXh0KGZpbGVuYW1lKVsxXQogICAgcmVwb3J0X2ZuID0gZmlsZW5hbWVbOi1sZW4oZl9leHQpXSsiLmFkb2MiCiAgICByZXBvcnRfZm4gPSBvcy5wYXRoLmJhc2VuYW1lKHJlcG9ydF9mbikKICAgIHJlcG9ydF9maCA9IG9wZW4ocmVwb3J0X2RpciArICIvIiArIHJlcG9ydF9mbiwgIncrIikKCiAgICAjIFJlbW92ZSBhbGwgSlNPTkMgY29tbWVudHMgZnJvbSB0aGUgSlNPTgogICAgc2YgPSBvcGVuKGZpbGVuYW1lLCdyJykucmVhZCgpCiAgICBnc29uSnNvblRyZWUgPSBKc29uUGFyc2VyLnBhcnNlU3RyaW5nKHNmKQogICAganNvbldpdGhvdXRDb21tZW50cyA9IGdzb25Kc29uVHJlZS50b1N0cmluZygpCiAgICBnc29uSnNvblRyZWUgPSBOb25lCgogICAgIyBSZXN0b3JlIEpTT04gZnJvbSBTdHJpbmcKICAgIGpiID0ganNvbi5sb2Fkcyhqc29uV2l0aG91dENvbW1lbnRzLCBvYmplY3RfcGFpcnNfaG9vaz1PcmRlcmVkRGljdCkKICAgIGpzb25XaXRob3V0Q29tbWVudHMgPSBOb25lCgogICAgIyBwcmludCBoZWFkZXIKICAgIHByaW50ZihoZWFkZXIucmVwbGFjZSgiX19DT05GSUdfRklMRU5BTUVfXyIsIGZpbGVuYW1lKS5yZXBsYWNlKCJfX0RFU0NSSVBUSU9OX18iLCBqYlsnYWN0aW9ucyddWydkZXNjcmlwdGlvbiddKSkKCiAgICAjIEFjdGlvbnMKICAgIGZvciBlIGluIGpiWydhY3Rpb25zJ10ua2V5cygpOgogICAgICAgIGlmIGUgaW4gWyd1c2VyX3BhcmFtcycsICd1c2VyX2FjdGlvbnMnXToKICAgICAgICAgICAgaWYgZSA9PSAndXNlcl9wYXJhbXMnOgogICAgICAgICAgICAgICAgZ2VuZXJhdGVfdGFibGUxKGUpCiAgICAgICAgICAgIGlmIGUgPT0gJ3VzZXJfYWN0aW9ucyc6CiAgICAgICAgICAgICAgICBnZW5lcmF0ZV90YWJsZTIoZSkKICAgICAgICAgICAgY29udGludWUKICAgICAgICAjIHwgKmRlc2NyaXB0aW9uKgogICAgICAgICMgfCBNaWNyby1iZW5jaG1hcmtzCiAgICAgICAgcHJpbnRmKCJ8ICoiICsgZSArICcqXG4nKQogICAgICAgIHByaW50ZigifCAiICsgamJbJ2FjdGlvbnMnXVtlXSArICdcbicpCiAgICBwcmludGYoInw9PT0iICsgJ1xuJykKCiAgICAjIFdvcmtmbG93cwogICAgaWYgIndvcmtmbG93cyIgaW4gamIua2V5cygpOgogICAgICAgIHByaW50ZigiXG4iKQogICAgICAgIHByaW50ZigiPT0gV29ya2Zsb3dzIFxuIikKICAgICAgICBnZW5lcmF0ZV93b3JrZmxvdygpCgogICAgIyBCZW5jaG1hcmtzIERhdGEKICAgIHByaW50ZigiXG4iKQogICAgcHJpbnRmKCI9PSBCZW5jaG1hcmtzXG4iKQogICAgZm9yIGsgaW4gamJbJ2JlbmNobWFya3MnXS5rZXlzKCk6CiAgICAgICAgYiA9IGpiWydiZW5jaG1hcmtzJ11ba10KICAgICAgICBwcmludGYoIlxuIikKICAgICAgICBwcmludGYoJz09PSAlcyclKGspICsgJ1xuJykKICAgICAgICBwcmludGYoIlxuIikKICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDJhIl1cbicpCiAgICAgICAgcHJpbnRmKCJ8PT09XG4iKQogICAgICAgIHByaW50ZigifCBpZCB8IHZhbHVlXG4iKQogICAgICAgICMgZW5hYmxlZAogICAgICAgIGlmICJlbmFibGVkIiBpbiBiLmtleXMoKToKICAgICAgICAgICAgcHJpbnRmKCd8ICplbmFibGVkKiB8ICVzXG4nJShiWyJlbmFibGVkIl0pKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50ZignfCAqZW5hYmxlZCogfCBUcnVlXG4nKQogICAgICAgICMgYXBzX3JhdGUKICAgICAgICBpZiAiYXBzX3JhdGUiIGluIGIua2V5cygpOgogICAgICAgICAgICBwcmludGYoJ3wgKmFwc19yYXRlKiB8ICUuMWZcbiclKGJbImFwc19yYXRlIl0pKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50ZignfCAqYXBzX3JhdGUqIHwgMC4wXG4nKQogICAgICAgICMgd29ya2VyX3RocmVhZF9xdWV1ZV9zaXplCiAgICAgICAgaWYgIndvcmtlcl90aHJlYWRfcXVldWVfc2l6ZSIgaW4gYi5rZXlzKCk6CiAgICAgICAgICAgIHByaW50ZignfCAqd29ya2VyX3RocmVhZF9xdWV1ZV9zaXplKiB8ICVkXG4nJShiWyJ3b3JrZXJfdGhyZWFkX3F1ZXVlX3NpemUiXSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRmKCd8ICp3b3JrZXJfdGhyZWFkX3F1ZXVlX3NpemUqIHwgMFxuJykKICAgICAgICAjIHdvcmtmbG93CiAgICAgICAgaWYgInNjZW5hcmlvX3dvcmtmbG93IiBpbiBiLmtleXMoKToKICAgICAgICAgICAgd29ya2Zsb3dfaXNfZGVmaW5lZCA9IGJbInNjZW5hcmlvX3dvcmtmbG93Il0gaW4gamJbIndvcmtmbG93cyJdLmtleXMoKQogICAgICAgICAgICBpZiB3b3JrZmxvd19pc19kZWZpbmVkOgogICAgICAgICAgICAgICAgcHJpbnRmKCd8ICpzY2VuYXJpb193b3JrZmxvdyogfCA8PCVzPj5cbiclKGJbInNjZW5hcmlvX3dvcmtmbG93Il0pKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRmKCd8ICpzY2VuYXJpb193b3JrZmxvdyogfCBFcnJvciwgc2NlbmFyaW9fd29ya2Zsb3cgKiVzKiBpcyBub3QgZGVmaW5lZFxuJyUoYlsic2NlbmFyaW9fd29ya2Zsb3ciXSkpCiAgICAgICAgZWxpZiAic2NlbmFyaW9fYWN0aW9ucyIgaW4gYi5rZXlzKCk6CiAgICAgICAgICAgIHByaW50ZignfCAqc2NlbmFyaW9fYWN0aW9ucyogXG4nKQogICAgICAgICAgICBwcmludGYoJ3wgXG4nKQogICAgICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDJhIl1cbicpCiAgICAgICAgICAgIHByaW50ZignIT09PVxuJykKICAgICAgICAgICAgcHJpbnRmKCchIGlkICEgd2VpZ2h0IFxuJykKICAgICAgICAgICAgZm9yIGEgaW4gYlsic2NlbmFyaW9fYWN0aW9ucyJdOgogICAgICAgICAgICAgICAgcHJpbnRmKCchICVkXG4nJShhWyJpZCJdKSkKICAgICAgICAgICAgICAgIGlmICJ3ZWlnaHQiIGluIGEua2V5cygpOgogICAgICAgICAgICAgICAgICAgIHByaW50ZignISAlZCBcbiclKGFbIndlaWdodCJdKSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCchIC0gXG4nKQogICAgICAgICAgICBwcmludGYoJyE9PT1cbicpCiAgICAgICAgIyB0aW1lCiAgICAgICAgaWYgInRpbWUiIGluIGIua2V5cygpOgogICAgICAgICAgICBwcmludGYoJ3wgKnRpbWUqIFxuJykKICAgICAgICAgICAgcHJpbnRmKCd8IFxuJykKICAgICAgICAgICAgcHJpbnRmKCdbJW5vaGVhZGVyLGNvbHM9IjJhLDFhIl1cbicpCiAgICAgICAgICAgIHByaW50ZignIT09PVxuJykKICAgICAgICAgICAgI3ByaW50ZignISBpZCAhIHZhbHVlIFxuJykKICAgICAgICAgICAgZm9yIGsgaW4gYlsidGltZSJdLmtleXMoKToKICAgICAgICAgICAgICAgIHByaW50ZignISAqJXMqXG4nJShrKSkKICAgICAgICAgICAgICAgIHByaW50ZignISAlZCBzZWNvbmRzXG4nJShiWyJ0aW1lIl1ba10pKQogICAgICAgICAgICBwcmludGYoJyE9PT1cbicpCgogICAgICAgIHByaW50ZigifD09PVxuIikKCiAgICAjIENvbnRleHQgRGF0YQogICAgcHJpbnRmKCJcbiIpCiAgICBwcmludGYoIj09IENvbnRleHRzXG4iKQogICAgcHJpbnRmKCJcbiIpCgogICAgZm9yIGsgaW4gamJbJ2NvbnRleHRzJ10ua2V5cygpOgogICAgICAgIGMgPSBqYlsnY29udGV4dHMnXVtrXQogICAgICAgIHByaW50ZignPT09ICVzJyUoaykgKyAnXG4nKQogICAgICAgIHByaW50ZignXG4nKQogICAgICAgIHByaW50ZignWyVoZWFkZXIsY29scz0iMWEsMmEiXVxuJykKICAgICAgICBwcmludGYoJ3w9PT1cbicpCiAgICAgICAgcHJpbnRmKCd8IGlkIHwgdmFsdWUgXG4nKQogICAgICAgIGlmICJlbmFibGVkIiBpbiBjLmtleXMoKToKICAgICAgICAgICAgcHJpbnRmKCd8ICplbmFibGVkKiB8ICVzXG4nJShjWyJlbmFibGVkIl0pKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50ZignfCAqZW5hYmxlZCogfCBUcnVlXG4nKQogICAgICAgIHByaW50ZignfCAqbnVtX3VzZXJzKiAgIHwgJWRcbiclKGNbIm51bV91c2VycyJdKSkKICAgICAgICBwcmludGYoJ3wgKm51bV90aHJlYWRzKiB8ICVkXG4nJShjWyJudW1fdGhyZWFkcyJdKSkKICAgICAgICBwcmludGYoInw9PT1cbiIpCgogICAgcmVwb3J0X2ZoLmNsb3NlKCkKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBpZiBsZW4oc3lzLmFyZ3YpID49IDI6CiAgICAgICAgZmlsZW5hbWUgPSBzeXMuYXJndlsxXQogICAgICAgIGNyZWF0ZVJlcG9ydChmaWxlbmFtZSkK";

  public static void main(String... args) {
    String mainScriptFilename = "report2.py";
    String mainScript = "";
    String pythonArgsScript = "";
    for (String arg : args) {
      if (pythonArgsScript.length() == 0) {
        if (!arg.equals(mainScriptFilename)) {
          pythonArgsScript += "'" + mainScriptFilename + "', ";
        }
      } else {
        pythonArgsScript += ", ";
      }
      pythonArgsScript += "'" + arg + "'";
    }
    if (pythonArgsScript.length() == 0) {
      pythonArgsScript = "'" + mainScriptFilename + "'";
    }
    pythonArgsScript = "import sys; sys.argv = [" + pythonArgsScript + "]";
    {
      byte[] decodedBytes = Base64.getDecoder().decode(mainScriptTextBase64);
      String text = new String(decodedBytes);
      mainScript = text;
    }
    {
      // create Python interpreter object
      PythonInterpreter pyInterp = new PythonInterpreter();
      // initialize command-line args
      pyInterp.exec(pythonArgsScript);
      // run script
      pyInterp.exec(mainScript);
    }
  }
}
