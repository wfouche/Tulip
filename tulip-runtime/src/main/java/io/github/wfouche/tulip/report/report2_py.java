package io.github.wfouche.tulip.report;

/// usr/bin/env jbang "$0" "$@" ; exit $?

// spotless:off
//DEPS com.google.code.gson:gson:2.11.0
//DEPS org.hdrhistogram:HdrHistogram:2.2.2
//DEPS org.python:jython-standalone:2.7.4
//JAVA 21
// spotless:on

import java.util.Base64;
import org.python.util.PythonInterpreter;

public class report2_py {

  public static String mainScriptTextBase64 =
      "ZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBwcmludF9mdW5jdGlvbg0KaW1wb3J0IGpzb24NCmltcG9ydCBzeXMNCmltcG9ydCBjb20uZ29vZ2xlLmdzb24uSnNvblBhcnNlciBhcyBKc29uUGFyc2VyDQppbXBvcnQgb3MNCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IE9yZGVyZWREaWN0DQoNCiMgLy8vIGpiYW5nDQojIHJlcXVpcmVzLWp5dGhvbiA9ICI9PTIuNy40Ig0KIyByZXF1aXJlcy1qYXZhID0gIj49MjEiDQojIGRlcGVuZGVuY2llcyA9IFsNCiMgICAiY29tLmdvb2dsZS5jb2RlLmdzb246Z3NvbjoyLjExLjAiLA0KIyAgICJvcmcuaGRyaGlzdG9ncmFtOkhkckhpc3RvZ3JhbToyLjIuMiINCiMgXQ0KIyBbcHl0aG9uLWp2bV0NCiMgICBkZWJ1ZyA9IGZhbHNlDQojIC8vLw0KDQpoZWFkZXIgPSAnJyc9IF9fREVTQ1JJUFRJT05fXw0KOnRvYzogbGVmdA0KOnNlY3RudW1zOg0KOmRpYWdyYW0tc2VydmVyLXVybDogaHR0cHM6Ly9rcm9raS5pby8NCjpkaWFncmFtLXNlcnZlci10eXBlOiBrcm9raV9pbw0KDQpGaWxlbmFtZTo6DQogIF9fQ09ORklHX0ZJTEVOQU1FX18NCg0KPT0gQWN0aW9ucw0KDQpbJWhlYWRlcixjb2xzPSIxYSw0YSJdDQp8PT09DQp8IGlkIHwgdmFsdWUNCicnJw0KDQpkZWYgY3JlYXRlUmVwb3J0KGZpbGVuYW1lKToNCg0KICAgIGRlZiBwcmludGYocyk6DQogICAgICAgIHJlcG9ydF9maC53cml0ZShzKQ0KDQogICAgZGVmIGFjdGlvbk5hbWUocyk6DQogICAgICAgIHJldHVybiBzLnNwbGl0KCIsIilbMF0uc3RyaXAoKQ0KDQogICAgZGVmIGFjdGlvbkRlc2Mocyk6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHJldHVybiBzLnNwbGl0KCIsIilbMV0uc3RyaXAoKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICByZXR1cm4gIiINCg0KICAgIGRlZiBnZW5lcmF0ZV90YWJsZTEoZSk6DQogICAgICAgIHByaW50ZigifCAqIiArIGUgKyAiKlxuIikNCiAgICAgICAgcHJpbnRmKCJ8XG4iKQ0KICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDNhIl1cbicpDQogICAgICAgIHByaW50ZignIT09PVxuJykNCiAgICAgICAgcHJpbnRmKCchIGlkICEgdmFsdWUgXG4nKQ0KICAgICAgICBmb3IgayBpbiBqYlsnYWN0aW9ucyddW2VdLmtleXMoKToNCiAgICAgICAgICAgIHByaW50ZignISAqJyArIGsgKyAnKiAnKQ0KICAgICAgICAgICAgcHJpbnRmKCchICcgKyBzdHIoamJbJ2FjdGlvbnMnXVtlXVtrXSkgKyAnXG4nKQ0KICAgICAgICBwcmludGYoJyE9PT1cbicpDQoNCiAgICBkZWYgZ2VuZXJhdGVfdGFibGUyKGUpOg0KICAgICAgICBwcmludGYoInwgKiIgKyBlICsgIipcbiIpDQogICAgICAgIHByaW50ZigifFxuIikNCiAgICAgICAgcHJpbnRmKCdbJWhlYWRlcixjb2xzPSIyYSwyYSw0YSJdXG4nKQ0KICAgICAgICBwcmludGYoJyE9PT1cbicpDQogICAgICAgIHByaW50ZignISBpZCAhIHZhbHVlICEgZGVzY3JpcHRpb25cbicpDQogICAgICAgIGZvciBrIGluIGpiWydhY3Rpb25zJ11bZV0ua2V5cygpOg0KICAgICAgICAgICAgcHJpbnRmKCchIConICsgayArICcqICcpDQogICAgICAgICAgICBwcmludGYoJyEgJyArIGFjdGlvbk5hbWUoc3RyKGpiWydhY3Rpb25zJ11bZV1ba10pKSkNCiAgICAgICAgICAgIHByaW50ZignISAnICsgYWN0aW9uRGVzYyhzdHIoamJbJ2FjdGlvbnMnXVtlXVtrXSkpICsgJ1xuJykNCiAgICAgICAgcHJpbnRmKCchPT09XG4nKQ0KDQogICAgZGVmIGdlbmVyYXRlX3dvcmtmbG93KCk6DQogICAgICAgIGRpYWdJZCA9IC0xDQogICAgICAgIGRlZiBuYW1lX3RvX2lkKHMpOg0KICAgICAgICAgICAgaWYgcyBpbiAnLSc6DQogICAgICAgICAgICAgICAgcmV0dXJuIDANCiAgICAgICAgICAgIHJldHVybiBpbnQocykNCiAgICAgICAgZGVmIGFjdGlvbl9uYW1lKHMpOg0KICAgICAgICAgICAgaWYgcyBpbiBqYlsnYWN0aW9ucyddWyd1c2VyX2FjdGlvbnMnXS5rZXlzKCk6DQogICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbk5hbWUoamJbJ2FjdGlvbnMnXVsndXNlcl9hY3Rpb25zJ11bc10pDQogICAgICAgICAgICByZXR1cm4gJzx1bmtub3duPicNCg0KICAgICAgICAjcHJpbnQoamIua2V5cygpKQ0KICAgICAgICAjcHJpbnQoamJbIndvcmtmbG93cyJdLmtleXMoKSkNCiAgICAgICAgZm9yIHduIGluIGpiWyJ3b3JrZmxvd3MiXS5rZXlzKCk6DQogICAgICAgICAgICBkaWFnSWQgKz0gMQ0KICAgICAgICAgICAgcHJpbnRmKCJcbiIpDQogICAgICAgICAgICBwcmludGYoIltbJXNdXVxuIiUod24pKQ0KICAgICAgICAgICAgcHJpbnRmKCI9PT0gIiArICIlc1xuIiUod24pKQ0KICAgICAgICAgICAgcHJpbnRmKCJcbiIpDQogICAgICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDFhIl1cbicpDQogICAgICAgICAgICBwcmludGYoJ3w9PT1cbicpDQogICAgICAgICAgICBwcmludGYoJ3wgV29ya2Zsb3cgRGlhZ3JhbSB8IFNwZWNpZmljYXRpb25cbicpDQogICAgICAgICAgICBwcmludGYoJ3wnKQ0KICAgICAgICAgICAgcHJpbnRmKCJbcGxhbnR1bWwsd2ZkJWQsc3ZnXSIlKGRpYWdJZCkgKyAnXG4nKQ0KICAgICAgICAgICAgcHJpbnRmKCctLS0tXG4nKQ0KICAgICAgICAgICAgcHJpbnRmKCdAc3RhcnR1bWxcbicpDQogICAgICAgICAgICAjcHJpbnRmKCd0aXRsZSAlc1xuJyUod24pKQ0KICAgICAgICAgICAgZm9yIHNuYW1lIGluIGpiWyd3b3JrZmxvd3MnXVt3bl0ua2V5cygpOg0KICAgICAgICAgICAgICAgIGlmIHNuYW1lIGluIFsnLSddOg0KICAgICAgICAgICAgICAgICAgICBwcmludGYoJ3N0YXRlICItIiBhcyBBMFxuJykNCiAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICBzaWQgPSBpbnQoc25hbWUpDQogICAgICAgICAgICAgICAgcHJpbnRmKCdzdGF0ZSAiQWN0aW9uICVkIiBhcyBBJWRcbiclKHNpZCxzaWQpKQ0KICAgICAgICAgICAgICAgIHByaW50ZignQSVkOiA8JXM+XG4nJShzaWQsYWN0aW9uX25hbWUoc25hbWUpKSkNCiAgICAgICAgICAgICAgICBwcmludGYoJ1xuJykNCiAgICAgICAgICAgIGZvciBzbmFtZSBpbiBqYlsnd29ya2Zsb3dzJ11bd25dLmtleXMoKToNCiAgICAgICAgICAgICAgICBpZiBzbmFtZSBpbiBbJyonXToNCiAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICBpZiBzbmFtZSBpbiBbJy0nXToNCiAgICAgICAgICAgICAgICAgICAgbWlkID0gMA0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIG1pZCA9IGludChzbmFtZSkNCiAgICAgICAgICAgICAgICBmb3IgayBpbiBqYlsnd29ya2Zsb3dzJ11bd25dW3NuYW1lXS5rZXlzKCk6DQogICAgICAgICAgICAgICAgICAgIG5pZCA9IG5hbWVfdG9faWQoaykNCiAgICAgICAgICAgICAgICAgICAgZnYgPSBqYlsnd29ya2Zsb3dzJ11bd25dW3NuYW1lXVtrXQ0KICAgICAgICAgICAgICAgICAgICBwcmludGYoJ0ElZCAtLT4gQSVkOiAlLjNmXG4nJShtaWQsbmlkLGZ2KSkNCiAgICAgICAgICAgIHByaW50ZignQGVuZHVtbFxuJykNCiAgICAgICAgICAgIHByaW50ZignLS0tLVxuJykNCiAgICAgICAgICAgIHByaW50ZignfCBcbicpDQogICAgICAgICAgICBwcmludGYoJ1tzb3VyY2UsanNvbl1cbicpDQogICAgICAgICAgICBwcmludGYoJy0tLS1cbicpDQogICAgICAgICAgICBwcmludGYoJyVzXG4nJShqc29uLmR1bXBzKGpiWyd3b3JrZmxvd3MnXVt3bl0sIGluZGVudD00KSkpDQogICAgICAgICAgICBwcmludGYoJy0tLS1cbicpDQogICAgICAgICAgICBwcmludGYoJ3w9PT1cbicpDQoNCiAgICAjcHJpbnQoIlxuQ29uZmlnIGZpbGVuYW1lID0gIiArIGZpbGVuYW1lKQ0KDQogICAgIyAuanNvbmMgLT4gLmFkb2MNCiAgICBmX2V4dCA9IG9zLnBhdGguc3BsaXRleHQoZmlsZW5hbWUpWzFdDQogICAgcmVwb3J0X2ZuID0gZmlsZW5hbWVbOi1sZW4oZl9leHQpXSsiLmFkb2MiDQogICAgcmVwb3J0X2ZoID0gb3BlbihyZXBvcnRfZm4sICJ3KyIpDQoNCiAgICAjIFJlbW92ZSBhbGwgSlNPTkMgY29tbWVudHMgZnJvbSB0aGUgSlNPTg0KICAgIHNmID0gb3BlbihmaWxlbmFtZSwncicpLnJlYWQoKQ0KICAgIGdzb25Kc29uVHJlZSA9IEpzb25QYXJzZXIucGFyc2VTdHJpbmcoc2YpDQogICAganNvbldpdGhvdXRDb21tZW50cyA9IGdzb25Kc29uVHJlZS50b1N0cmluZygpDQogICAgZ3Nvbkpzb25UcmVlID0gTm9uZQ0KDQogICAgIyBSZXN0b3JlIEpTT04gZnJvbSBTdHJpbmcNCiAgICBqYiA9IGpzb24ubG9hZHMoanNvbldpdGhvdXRDb21tZW50cywgb2JqZWN0X3BhaXJzX2hvb2s9T3JkZXJlZERpY3QpDQogICAganNvbldpdGhvdXRDb21tZW50cyA9IE5vbmUNCg0KICAgICMgcHJpbnQgaGVhZGVyDQogICAgcHJpbnRmKGhlYWRlci5yZXBsYWNlKCJfX0NPTkZJR19GSUxFTkFNRV9fIiwgZmlsZW5hbWUpLnJlcGxhY2UoIl9fREVTQ1JJUFRJT05fXyIsIGpiWydhY3Rpb25zJ11bJ2Rlc2NyaXB0aW9uJ10pKQ0KDQogICAgIyBBY3Rpb25zDQogICAgZm9yIGUgaW4gamJbJ2FjdGlvbnMnXS5rZXlzKCk6DQogICAgICAgIGlmIGUgaW4gWyd1c2VyX3BhcmFtcycsICd1c2VyX2FjdGlvbnMnXToNCiAgICAgICAgICAgIGlmIGUgPT0gJ3VzZXJfcGFyYW1zJzoNCiAgICAgICAgICAgICAgICBnZW5lcmF0ZV90YWJsZTEoZSkNCiAgICAgICAgICAgIGlmIGUgPT0gJ3VzZXJfYWN0aW9ucyc6DQogICAgICAgICAgICAgICAgZ2VuZXJhdGVfdGFibGUyKGUpDQogICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAjIHwgKmRlc2NyaXB0aW9uKg0KICAgICAgICAjIHwgTWljcm8tYmVuY2htYXJrcw0KICAgICAgICBwcmludGYoInwgKiIgKyBlICsgJypcbicpDQogICAgICAgIHByaW50ZigifCAiICsgamJbJ2FjdGlvbnMnXVtlXSArICdcbicpDQogICAgcHJpbnRmKCJ8PT09IiArICdcbicpDQoNCiAgICAjIFdvcmtmbG93cw0KICAgIGlmICJ3b3JrZmxvd3MiIGluIGpiLmtleXMoKToNCiAgICAgICAgcHJpbnRmKCJcbiIpDQogICAgICAgIHByaW50ZigiPT0gV29ya2Zsb3dzIFxuIikNCiAgICAgICAgZ2VuZXJhdGVfd29ya2Zsb3coKQ0KDQogICAgIyBCZW5jaG1hcmtzIERhdGENCiAgICBwcmludGYoIlxuIikNCiAgICBwcmludGYoIj09IEJlbmNobWFya3NcbiIpDQogICAgZm9yIGsgaW4gamJbJ2JlbmNobWFya3MnXS5rZXlzKCk6DQogICAgICAgIGIgPSBqYlsnYmVuY2htYXJrcyddW2tdDQogICAgICAgIHByaW50ZigiXG4iKQ0KICAgICAgICBwcmludGYoJz09PSAlcyclKGspICsgJ1xuJykNCiAgICAgICAgcHJpbnRmKCJcbiIpDQogICAgICAgIHByaW50ZignWyVoZWFkZXIsY29scz0iMWEsMmEiXVxuJykNCiAgICAgICAgcHJpbnRmKCJ8PT09XG4iKQ0KICAgICAgICBwcmludGYoInwgaWQgfCB2YWx1ZVxuIikNCiAgICAgICAgIyBlbmFibGVkDQogICAgICAgIGlmICJlbmFibGVkIiBpbiBiLmtleXMoKToNCiAgICAgICAgICAgIHByaW50ZignfCAqZW5hYmxlZCogfCAlc1xuJyUoYlsiZW5hYmxlZCJdKSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50ZignfCAqZW5hYmxlZCogfCBUcnVlXG4nKQ0KICAgICAgICAjIGFwc19yYXRlDQogICAgICAgIGlmICJhcHNfcmF0ZSIgaW4gYi5rZXlzKCk6DQogICAgICAgICAgICBwcmludGYoJ3wgKmFwc19yYXRlKiB8ICUuMWZcbiclKGJbImFwc19yYXRlIl0pKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnRmKCd8ICphcHNfcmF0ZSogfCAwLjBcbicpDQogICAgICAgICMgd29ya2VyX3RocmVhZF9xdWV1ZV9zaXplDQogICAgICAgIGlmICJ3b3JrZXJfdGhyZWFkX3F1ZXVlX3NpemUiIGluIGIua2V5cygpOg0KICAgICAgICAgICAgcHJpbnRmKCd8ICp3b3JrZXJfdGhyZWFkX3F1ZXVlX3NpemUqIHwgJWRcbiclKGJbIndvcmtlcl90aHJlYWRfcXVldWVfc2l6ZSJdKSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50ZignfCAqd29ya2VyX3RocmVhZF9xdWV1ZV9zaXplKiB8IDBcbicpDQogICAgICAgICMgd29ya2Zsb3cNCiAgICAgICAgaWYgInNjZW5hcmlvX3dvcmtmbG93IiBpbiBiLmtleXMoKToNCiAgICAgICAgICAgIHdvcmtmbG93X2lzX2RlZmluZWQgPSBiWyJzY2VuYXJpb193b3JrZmxvdyJdIGluIGpiWyJ3b3JrZmxvd3MiXS5rZXlzKCkNCiAgICAgICAgICAgIGlmIHdvcmtmbG93X2lzX2RlZmluZWQ6DQogICAgICAgICAgICAgICAgcHJpbnRmKCd8ICpzY2VuYXJpb193b3JrZmxvdyogfCA8PCVzPj5cbiclKGJbInNjZW5hcmlvX3dvcmtmbG93Il0pKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcmludGYoJ3wgKnNjZW5hcmlvX3dvcmtmbG93KiB8IEVycm9yLCBzY2VuYXJpb193b3JrZmxvdyAqJXMqIGlzIG5vdCBkZWZpbmVkXG4nJShiWyJzY2VuYXJpb193b3JrZmxvdyJdKSkNCiAgICAgICAgZWxpZiAic2NlbmFyaW9fYWN0aW9ucyIgaW4gYi5rZXlzKCk6DQogICAgICAgICAgICBwcmludGYoJ3wgKnNjZW5hcmlvX2FjdGlvbnMqIFxuJykNCiAgICAgICAgICAgIHByaW50ZignfCBcbicpDQogICAgICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDJhIl1cbicpDQogICAgICAgICAgICBwcmludGYoJyE9PT1cbicpDQogICAgICAgICAgICBwcmludGYoJyEgaWQgISB3ZWlnaHQgXG4nKQ0KICAgICAgICAgICAgZm9yIGEgaW4gYlsic2NlbmFyaW9fYWN0aW9ucyJdOg0KICAgICAgICAgICAgICAgIHByaW50ZignISAlZFxuJyUoYVsiaWQiXSkpDQogICAgICAgICAgICAgICAgaWYgIndlaWdodCIgaW4gYS5rZXlzKCk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ZignISAlZCBcbiclKGFbIndlaWdodCJdKSkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBwcmludGYoJyEgLSBcbicpDQogICAgICAgICAgICBwcmludGYoJyE9PT1cbicpDQogICAgICAgICMgdGltZQ0KICAgICAgICBpZiAidGltZSIgaW4gYi5rZXlzKCk6DQogICAgICAgICAgICBwcmludGYoJ3wgKnRpbWUqIFxuJykNCiAgICAgICAgICAgIHByaW50ZignfCBcbicpDQogICAgICAgICAgICBwcmludGYoJ1slbm9oZWFkZXIsY29scz0iMmEsMWEiXVxuJykNCiAgICAgICAgICAgIHByaW50ZignIT09PVxuJykNCiAgICAgICAgICAgICNwcmludGYoJyEgaWQgISB2YWx1ZSBcbicpDQogICAgICAgICAgICBmb3IgayBpbiBiWyJ0aW1lIl0ua2V5cygpOg0KICAgICAgICAgICAgICAgIHByaW50ZignISAqJXMqXG4nJShrKSkNCiAgICAgICAgICAgICAgICBwcmludGYoJyEgJWQgc2Vjb25kc1xuJyUoYlsidGltZSJdW2tdKSkNCiAgICAgICAgICAgIHByaW50ZignIT09PVxuJykNCg0KICAgICAgICBwcmludGYoInw9PT1cbiIpDQoNCiAgICAjIENvbnRleHQgRGF0YQ0KICAgIHByaW50ZigiXG4iKQ0KICAgIHByaW50ZigiPT0gQ29udGV4dHNcbiIpDQogICAgcHJpbnRmKCJcbiIpDQoNCiAgICBmb3IgayBpbiBqYlsnY29udGV4dHMnXS5rZXlzKCk6DQogICAgICAgIGMgPSBqYlsnY29udGV4dHMnXVtrXQ0KICAgICAgICBwcmludGYoJz09PSAlcyclKGspICsgJ1xuJykNCiAgICAgICAgcHJpbnRmKCdcbicpDQogICAgICAgIHByaW50ZignWyVoZWFkZXIsY29scz0iMWEsMmEiXVxuJykNCiAgICAgICAgcHJpbnRmKCd8PT09XG4nKQ0KICAgICAgICBwcmludGYoJ3wgaWQgfCB2YWx1ZSBcbicpDQogICAgICAgIGlmICJlbmFibGVkIiBpbiBjLmtleXMoKToNCiAgICAgICAgICAgIHByaW50ZignfCAqZW5hYmxlZCogfCAlc1xuJyUoY1siZW5hYmxlZCJdKSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50ZignfCAqZW5hYmxlZCogfCBUcnVlXG4nKQ0KICAgICAgICBwcmludGYoJ3wgKm51bV91c2VycyogICB8ICVkXG4nJShjWyJudW1fdXNlcnMiXSkpDQogICAgICAgIHByaW50ZignfCAqbnVtX3RocmVhZHMqIHwgJWRcbiclKGNbIm51bV90aHJlYWRzIl0pKQ0KICAgICAgICBwcmludGYoInw9PT1cbiIpDQoNCiAgICByZXBvcnRfZmguY2xvc2UoKQ0KDQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOg0KICAgIGlmIGxlbihzeXMuYXJndikgPj0gMjoNCiAgICAgICAgZmlsZW5hbWUgPSBzeXMuYXJndlsxXQ0KICAgICAgICBjcmVhdGVSZXBvcnQoZmlsZW5hbWUpDQo=";

  public static void main(String... args) {
    String mainScriptFilename = "report2.py";
    String mainScript = "";
    String pythonArgsScript = "";
    for (String arg : args) {
      if (pythonArgsScript.length() == 0) {
        if (!arg.equals(mainScriptFilename)) {
          pythonArgsScript += "'" + mainScriptFilename + "', ";
        }
      } else {
        pythonArgsScript += ", ";
      }
      pythonArgsScript += "'" + arg + "'";
    }
    if (pythonArgsScript.length() == 0) {
      pythonArgsScript = "'" + mainScriptFilename + "'";
    }
    pythonArgsScript = "import sys; sys.argv = [" + pythonArgsScript + "]";
    {
      byte[] decodedBytes = Base64.getDecoder().decode(mainScriptTextBase64);
      String text = new String(decodedBytes);
      mainScript = text;
    }
    {
      // create Python interpreter object
      PythonInterpreter pyInterp = new PythonInterpreter();
      // initialize command-line args
      pyInterp.exec(pythonArgsScript);
      // run script
      pyInterp.exec(mainScript);
    }
  }
}
