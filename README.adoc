= Tulip (The Ultimate Load Injection Program)
:sectnums:
:toc:

== Dependencies

Install Git and JDK21 before building Tulip from source.

=== Linux

Install SDKMAN from bash (https://sdkman.io)
----
$ curl -s "https://get.sdkman.io" | bash
----

----
$ source "$HOME/.sdkman/bin/sdkman-init.sh"
----

----
$ sdk version
----

Install `w3m` (Debian, Ubuntu) to display reports
----
$ sudo apt install w3m
----

=== MacOS

Install SDKMAN from zsh or bash (https://sdkman.io)
----
$ curl -s "https://get.sdkman.io" | bash
----

----
$ source "$HOME/.sdkman/bin/sdkman-init.sh"
----

----
$ sdk version
----

Install `w3m` (MacOS) to display reports
----
$ brew install w3m
----

=== Windows

Open a Windows PowerShell (PS) terminal (version 5.1 or later) and from the PS `C:\>` prompt, run:

.Step 1 - run Set-ExecutionPolicy
----
PS C:\> Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
----
.Step 2 - answer 'Y' when prompted to change the execution policy.
----
Execution Policy Change
The execution policy helps protect you from scripts that you do not trust. Changing the execution policy might expose you to the security risks described in the about_Execution_Policies help topic at https:/go.microsoft.com/fwlink/?LinkID=135170. Do you want to change the execution policy?
[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is "N"): Y
PS C:\>
----

.Step 3 - run Invoke-RestMethod
----
PS C:\> Invoke-RestMethod -Uri https://get.scoop.sh | Invoke-Expression
----

.Step 4 - wait for the installation to finish
----
Initializing...
Downloading...
Extracting...
Creating shim...
Adding ~\scoop\shims to your path.
Scoop was installed successfully!
Type 'scoop help' for instructions.
PS C:\>
----

Install Git and Git-Bash

[source,cmd]
----
scoop install git
----

Install MS Java 21 (OpenJDK)
----
scoop bucket add java
----

----
scoop install microsoft21-jdk
----

(Optionally) Install WinGetUI (aka UniGetUI) to apply future updates to the installed applications
----
scoop bucket add extras
----
----
scoop install extras/wingetui
----

== Build from Source

=== Linux

----
git clone https://github.com/wfouche/Tulip.git
cd  Tulip
sdk env install
./go_bench.sh
----

=== MacOS

----
git clone https://github.com/wfouche/Tulip.git
cd  Tulip
sdk env install
go_bench.sh
----

=== Windows

----
git clone https://github.com/wfouche/Tulip.git
cd  Tulip
go_bench.cmd
----

== Example Benchmark Reports

=== HTTP API calls (fast remote system)

[source,text,options=nowrap]
----
Benchmark Report / Micro-benchmarks / 2024-08-14 10:19:41.768

SID          Name                 RID        Duration    #N     #F Avg WT Max WT  Avg QS Max QS  Avg TPS    Avg RT   Stdev   90p RT   99p RT   Max RT    Max RTT
0   Init (u:16 t:2)
                           0                 0.055    32        0  1.4 ms 38.7 ms 1.000  1      581.8     0.271 ms   1.3 ms 0.1 ms   7.3 ms   7.3 ms   14 10:19:41
                           [-]               0:00:00  32        0  1.4 ms 38.7 ms 1.000  1      581.8     0.271 ms   1.3 ms 0.1 ms   7.3 ms   7.3 ms   14 10:19:41
                           [0.start]         0:00:00  16        0  1.4 ms 38.7 ms 1.000  1      290.9     0.494 ms   1.7 ms 0.1 ms   7.3 ms   7.3 ms   14 10:19:41
                           [8.login]         0:00:00  16        0  1.4 ms 38.7 ms 1.000  1      290.9     0.048 ms   0.1 ms 0.1 ms   0.4 ms   0.4 ms   14 10:19:41
0   Max TPS-a (u:16 t:2)
                           0                 30.0     39695722  0  0.0 ms 1.3 ms  3.491  11     1323190.7 0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.1 ms   14 10:20:41
                           1                 30.0     39493564  0  0.0 ms 2.2 ms  3.476  11     1316452.1 0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.2 ms   14 10:21:01
                           2                 30.0     39799639  0  0.0 ms 1.2 ms  3.513  11     1326654.6 0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.1 ms   14 10:21:34
                           [-]               0:01:30  118988925 0  0.0 ms 2.2 ms  3.513  11     1322099.2 0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.2 ms   14 10:21:01
                           [9.noop]          0:01:30  118988925 0  0.0 ms 2.2 ms  3.513  11     1322099.2 0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.2 ms   14 10:21:01
0   Max TPS-b (u:16 t:2)
                           0                 30.0     29999999  0  0.0 ms 1.0 ms  2.705  11     1000000.0 0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.1 ms   14 10:23:11
                           1                 30.0     30000000  0  0.0 ms 1.1 ms  2.707  11     1000000.0 0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.1 ms   14 10:23:43
                           2                 30.0     29999996  0  0.0 ms 1.0 ms  2.705  11     999999.9  0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.1 ms   14 10:23:54
                           [-]               0:01:30  89999995  0  0.0 ms 1.1 ms  2.707  11     999999.9  0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.1 ms   14 10:23:11
                           [9.noop]          0:01:30  89999995  0  0.0 ms 1.1 ms  2.707  11     999999.9  0.000 ms   0.0 ms 0.0 ms   0.0 ms   0.1 ms   14 10:23:11
0   Fixed TPS-a (u:16 t:2)
                           0                 30.0     3001      0  6.1 ms 70.5 ms 1.177  3      100.0     12.085 ms  8.3 ms 25.1 ms  28.2 ms  28.3 ms  14 10:24:57
                           1                 30.0     2999      0  6.4 ms 65.0 ms 1.183  3      100.0     12.278 ms  8.3 ms 25.2 ms  28.2 ms  28.2 ms  14 10:25:49
                           2                 30.0     3000      0  7.3 ms 79.5 ms 1.227  3      100.0     12.286 ms  8.3 ms 25.2 ms  28.2 ms  28.2 ms  14 10:26:17
                           3                 30.0     3001      0  7.4 ms 77.4 ms 1.239  3      100.0     11.975 ms  8.2 ms 24.2 ms  28.2 ms  28.2 ms  14 10:26:34
                           [-]               0:02:00  12001     0  7.4 ms 79.5 ms 1.239  3      100.0     12.156 ms  8.3 ms 25.1 ms  28.2 ms  28.3 ms  14 10:24:57
                           [1.DELAY-6ms]     0:02:00  2988      0  7.4 ms 79.5 ms 1.239  3      24.9      6.134 ms   3.8 ms 11.2 ms  12.2 ms  12.2 ms  14 10:25:31
                           [2.DELAY-14ms]    0:02:00  9013      0  7.4 ms 79.5 ms 1.239  3      75.1      14.152 ms  8.4 ms 26.1 ms  28.2 ms  28.3 ms  14 10:24:57
0   Fixed TPS-b (u:16 t:2)
                           0                 30.0     3001      0  0.3 ms 2.2 ms  0.904  1      100.0     10.166 ms  0.0 ms 10.2 ms  10.2 ms  10.4 ms  14 10:27:52
                           1                 30.0     3000      0  0.3 ms 3.2 ms  0.997  1      100.0     10.163 ms  0.0 ms 10.2 ms  10.2 ms  10.3 ms  14 10:28:03
                           2                 30.0     3001      0  0.3 ms 3.5 ms  1.000  1      100.0     10.163 ms  0.0 ms 10.2 ms  10.2 ms  10.3 ms  14 10:28:48
                           3                 30.0     3001      0  0.3 ms 2.2 ms  0.998  1      100.0     10.161 ms  0.0 ms 10.2 ms  10.2 ms  10.3 ms  14 10:29:09
                           [-]               0:02:00  12003     0  0.3 ms 3.5 ms  1.000  1      100.0     10.163 ms  0.0 ms 10.2 ms  10.2 ms  10.4 ms  14 10:27:52
                           [10.DELAY-10ms]   0:02:00  12003     0  0.3 ms 3.5 ms  1.000  1      100.0     10.163 ms  0.0 ms 10.2 ms  10.2 ms  10.4 ms  14 10:27:52
0   HTTP-a (u:16 t:2)
                           0                 30.0     307248    0  1.6 ms 5.7 ms  8.391  11     10241.6   0.185 ms   0.0 ms 0.2 ms   0.3 ms   2.8 ms   14 10:30:20
                           1                 30.0     305262    0  1.6 ms 5.8 ms  8.413  11     10175.4   0.187 ms   0.0 ms 0.2 ms   0.3 ms   2.0 ms   14 10:30:37
                           2                 30.0     302191    0  1.6 ms 6.4 ms  8.394  11     10073.0   0.188 ms   0.0 ms 0.2 ms   0.3 ms   1.9 ms   14 10:31:07
                           [-]               0:01:30  914701    0  1.6 ms 6.4 ms  8.413  11     10163.3   0.187 ms   0.0 ms 0.2 ms   0.3 ms   2.8 ms   14 10:30:20
                           [3.HTTP-posts]    0:01:30  182941    0  1.6 ms 6.4 ms  8.413  11     2032.7    0.186 ms   0.0 ms 0.2 ms   0.3 ms   1.9 ms   14 10:30:37
                           [4.HTTP-comments] 0:01:30  182943    0  1.6 ms 6.4 ms  8.413  11     2032.7    0.186 ms   0.0 ms 0.2 ms   0.3 ms   2.0 ms   14 10:30:37
                           [5.HTTP-albums]   0:01:30  182941    0  1.6 ms 6.4 ms  8.413  11     2032.7    0.187 ms   0.0 ms 0.2 ms   0.3 ms   2.8 ms   14 10:30:20
                           [6.HTTP-photos]   0:01:30  182939    0  1.6 ms 6.4 ms  8.413  11     2032.7    0.187 ms   0.0 ms 0.2 ms   0.3 ms   2.0 ms   14 10:30:37
                           [7.HTTP-todos]    0:01:30  182937    0  1.6 ms 6.4 ms  8.413  11     2032.6    0.187 ms   0.0 ms 0.2 ms   0.3 ms   1.9 ms   14 10:30:07
0   HTTP-b (u:16 t:2)
                           0                 30.0     37502     0  0.1 ms 3.9 ms  1.137  3      1250.1    0.620 ms   0.2 ms 0.8 ms   0.9 ms   3.0 ms   14 10:32:33
                           1                 30.0     37501     0  0.1 ms 3.9 ms  1.135  3      1250.0    0.647 ms   0.1 ms 0.8 ms   0.9 ms   3.8 ms   14 10:32:55
                           2                 30.0     37501     0  0.1 ms 2.9 ms  1.138  3      1250.0    0.650 ms   0.1 ms 0.8 ms   0.9 ms   2.8 ms   14 10:33:19
                           [-]               0:01:30  112504    0  0.1 ms 3.9 ms  1.138  3      1250.0    0.639 ms   0.1 ms 0.8 ms   0.9 ms   3.8 ms   14 10:32:55
                           [3.HTTP-posts]    0:01:30  22502     0  0.1 ms 3.9 ms  1.138  3      250.0     0.637 ms   0.1 ms 0.8 ms   0.9 ms   3.0 ms   14 10:32:33
                           [4.HTTP-comments] 0:01:30  22502     0  0.1 ms 3.9 ms  1.138  3      250.0     0.638 ms   0.1 ms 0.8 ms   0.9 ms   2.9 ms   14 10:33:08
                           [5.HTTP-albums]   0:01:30  22500     0  0.1 ms 3.9 ms  1.138  3      250.0     0.639 ms   0.1 ms 0.8 ms   0.9 ms   3.8 ms   14 10:32:55
                           [6.HTTP-photos]   0:01:30  22499     0  0.1 ms 3.9 ms  1.138  3      250.0     0.641 ms   0.1 ms 0.8 ms   0.9 ms   2.8 ms   14 10:33:19
                           [7.HTTP-todos]    0:01:30  22501     0  0.1 ms 3.9 ms  1.138  3      250.0     0.641 ms   0.1 ms 0.8 ms   0.9 ms   2.7 ms   14 10:33:30
0   Shutdown (u:16 t:2)
                           0                 1.609    16        0  0.1 ms 0.1 ms  1.000  1      9.9       100.336 ms 0.2 ms 100.4 ms 101.1 ms 101.1 ms 14 10:33:47
                           [-]               0:00:01  16        0  0.1 ms 0.1 ms  1.000  1      9.9       100.336 ms 0.2 ms 100.4 ms 101.2 ms 101.1 ms 14 10:33:47
                           [99.stop]         0:00:01  16        0  0.1 ms 0.1 ms  1.000  1      9.9       100.336 ms 0.2 ms 100.4 ms 101.2 ms 101.1 ms 14 10:33:47

----

=== HTTP API calls (slow remote system)

[source,text,options=nowrap]
----
Benchmark Report / Micro-benchmarks / 2024-08-29 18:38:48.649

SID    Name            RID        Duration    #N    #F  Avg TPS    Min RT    Avg RT    Stdev    90p RT   99p RT   Max RT     Max RTT   MQS AQS  Max WT    Avg WT   CPU  JMM
0   Init
    (u:16 t:2)  0                 0.064    32       0  500.000    0.0 ms   0.291 ms   1.3 ms   0.1 ms   7.4 ms   7.4 ms    29 18:38:48 1   0.9 44.3 ms   1.6 ms   0.0   12.2
                [0.start]         0:00:00  16       0  250.000    0.0 ms   0.506 ms   1.8 ms   0.1 ms   7.4 ms   7.4 ms    29 18:38:48 1   0.9 44.3 ms   1.6 ms   0.0   12.2
                [8.login]         0:00:00  16       0  250.000    0.0 ms   0.076 ms   0.1 ms   0.3 ms   0.5 ms   0.5 ms    29 18:38:48 1   0.9 44.3 ms   1.6 ms   0.0   12.2
                                  0:00:00  32       0  500.000    0.0 ms   0.291 ms   1.3 ms   0.1 ms   7.4 ms   7.4 ms    29 18:38:48 1   0.9 44.3 ms   1.6 ms   0.0   12.2

SID    Name            RID        Duration    #N    #F  Avg TPS    Min RT    Avg RT    Stdev    90p RT   99p RT   Max RT     Max RTT   MQS AQS  Max WT    Avg WT   CPU  JMM
0   Max TPS-a
    (u:16 t:2)  0                 30.0     25571398 0  852379.933 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   3.5 ms    29 18:40:00 11  3.8 25.5 ms   0.0 ms   99.5  41.9
                1                 30.0     6808017  0  226933.900 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   4.3 ms    29 18:40:30 11  4.9 17.0 ms   0.0 ms   100.0 41.9
                2                 30.0     11465960 0  382198.667 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   3.0 ms    29 18:40:58 11  4.5 18.4 ms   0.0 ms   100.0 41.9
                [9.noop]          0:01:30  43845375 0  487170.833 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   4.3 ms    29 18:40:30 11  4.9 25.5 ms   0.0 ms   100.0 41.9
                                  0:01:30  43845375 0  487170.833 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   4.3 ms    29 18:40:30 11  4.9 25.5 ms   0.0 ms   100.0 41.9

SID    Name            RID        Duration    #N    #F  Avg TPS    Min RT    Avg RT    Stdev    90p RT   99p RT   Max RT     Max RTT   MQS AQS  Max WT    Avg WT   CPU  JMM
0   Max TPS-b
    (u:16 t:2)  0                 30.0     29999972 0  999999.067 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   0.1 ms    29 18:42:14 11  2.8 6.9 ms    0.0 ms   98.4  41.9
                1                 30.0     29999999 0  999999.967 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   0.6 ms    29 18:42:30 11  2.8 5.6 ms    0.0 ms   72.5  41.9
                2                 30.0     27604995 0  920166.500 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   1.8 ms    29 18:43:28 11  2.9 8.4 ms    0.0 ms   88.7  41.9
                [9.noop]          0:01:30  87604966 0  973388.511 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   1.8 ms    29 18:43:28 11  2.9 8.4 ms    0.0 ms   98.4  41.9
                                  0:01:30  87604966 0  973388.511 0.0 ms   0.000 ms   0.0 ms   0.0 ms   0.0 ms   1.8 ms    29 18:43:28 11  2.9 8.4 ms    0.0 ms   98.4  41.9

SID    Name            RID        Duration    #N    #F  Avg TPS    Min RT    Avg RT    Stdev    90p RT   99p RT   Max RT     Max RTT   MQS AQS  Max WT    Avg WT   CPU  JMM
0   Fixed TPS-a
    (u:16 t:2)  0                 30.0     3001     0  100.033    0.0 ms   12.135 ms  8.3 ms   24.2 ms  28.2 ms  29.2 ms   29 18:44:33 3   1.2 63.5 ms   6.0 ms   99.6  24.6
                1                 30.0     3000     0  100.000    0.0 ms   12.025 ms  8.3 ms   25.1 ms  28.2 ms  28.3 ms   29 18:44:40 3   1.2 69.4 ms   6.4 ms   15.8  22.1
                2                 30.0     3001     0  100.033    0.0 ms   12.358 ms  8.3 ms   25.1 ms  28.2 ms  41.1 ms   29 18:45:22 4   1.1 82.2 ms   7.3 ms   99.6  22.1
                3                 30.0     3000     0  100.000    0.0 ms   11.931 ms  8.2 ms   24.1 ms  28.1 ms  32.1 ms   29 18:45:38 4   1.1 72.1 ms   5.9 ms   97.8  22.1
                [1.DELAY-6ms]     0:02:00  2997     0  24.975     0.0 ms   6.197 ms   3.8 ms   11.2 ms  12.2 ms  14.7 ms   29 18:44:04 4   1.2 82.2 ms   7.3 ms   99.6  24.6
                [2.DELAY-14ms]    0:02:00  9005     0  75.042     0.0 ms   14.081 ms  8.4 ms   26.1 ms  28.2 ms  41.1 ms   29 18:45:22 4   1.2 82.2 ms   7.3 ms   99.6  24.6
                                  0:02:00  12002    0  100.017    0.0 ms   12.113 ms  8.3 ms   24.5 ms  28.2 ms  41.1 ms   29 18:45:22 4   1.2 82.2 ms   7.3 ms   99.6  24.6

SID    Name            RID        Duration    #N    #F  Avg TPS    Min RT    Avg RT    Stdev    90p RT   99p RT   Max RT     Max RTT   MQS AQS  Max WT    Avg WT   CPU  JMM
0   Fixed TPS-b
    (u:16 t:2)  0                 30.0     3001     0  100.033    10.1 ms  10.159 ms  0.0 ms   10.2 ms  10.2 ms  10.4 ms   29 18:46:50 1   1.0 2.2 ms    0.3 ms   79.7  15.7
                1                 30.0     3001     0  100.033    10.0 ms  10.123 ms  0.1 ms   10.2 ms  10.3 ms  12.3 ms   29 18:47:38 1   1.0 2.9 ms    0.2 ms   43.9  15.6
                2                 30.0     3001     0  100.033    10.0 ms  10.159 ms  0.2 ms   10.2 ms  10.6 ms  16.3 ms   29 18:47:51 1   1.0 5.2 ms    0.3 ms   54.3  15.6
                3                 30.0     3001     0  100.033    10.0 ms  10.162 ms  0.1 ms   10.2 ms  10.3 ms  13.4 ms   29 18:48:15 1   1.0 6.4 ms    0.3 ms   45.4  7.1
                [10.DELAY-10ms]   0:02:00  12004    0  100.033    10.0 ms  10.151 ms  0.1 ms   10.2 ms  10.3 ms  16.3 ms   29 18:47:51 1   1.0 6.4 ms    0.3 ms   79.7  15.7
                                  0:02:00  12004    0  100.033    10.0 ms  10.151 ms  0.1 ms   10.2 ms  10.3 ms  16.3 ms   29 18:47:51 1   1.0 6.4 ms    0.3 ms   79.7  15.7

SID    Name            RID        Duration    #N    #F  Avg TPS    Min RT    Avg RT    Stdev    90p RT   99p RT   Max RT     Max RTT   MQS AQS  Max WT    Avg WT   CPU  JMM
0   HTTP-a
    (u:16 t:2)  0                 30.0     1450     0  48.333     30.5 ms  44.681 ms  188.9 ms 46.7 ms  83.3 ms  7219.5 ms 29 18:49:19 11  8.6 7610.4 ms 403.7 ms 31.8  9.7
                1                 30.0     1494     0  49.800     29.6 ms  39.113 ms  11.5 ms  45.8 ms  79.4 ms  228.3 ms  29 18:49:51 11  8.3 902.7 ms  330.3 ms 10.7  13.4
                2                 30.0     1454     0  48.467     30.0 ms  39.442 ms  12.4 ms  45.5 ms  102.0 ms 158.1 ms  29 18:50:30 11  8.4 744.4 ms  337.7 ms 13.1  13.4
                [3.HTTP-posts]    0:01:30  880      0  9.778      30.3 ms  39.771 ms  15.9 ms  45.7 ms  96.5 ms  363.5 ms  29 18:49:45 11  8.6 7610.4 ms 403.7 ms 31.8  13.4
                [4.HTTP-comments] 0:01:30  879      0  9.767      29.8 ms  39.741 ms  13.0 ms  47.1 ms  97.5 ms  182.2 ms  29 18:49:40 11  8.6 7610.4 ms 403.7 ms 31.8  13.4
                [5.HTTP-albums]   0:01:30  881      0  9.789      29.6 ms  38.928 ms  10.3 ms  45.1 ms  77.8 ms  220.4 ms  29 18:49:40 11  8.6 7610.4 ms 403.7 ms 31.8  13.4
                [6.HTTP-photos]   0:01:30  880      0  9.778      30.3 ms  47.469 ms  242.1 ms 46.2 ms  99.2 ms  7219.5 ms 29 18:49:19 11  8.6 7610.4 ms 403.7 ms 31.8  13.4
                [7.HTTP-todos]    0:01:30  878      0  9.756      30.0 ms  39.378 ms  11.7 ms  46.3 ms  97.0 ms  227.6 ms  29 18:49:51 11  8.6 7610.4 ms 403.7 ms 31.8  13.4
                                  0:01:30  4398     0  48.867     29.6 ms  41.058 ms  109.0 ms 46.0 ms  95.2 ms  7219.5 ms 29 18:49:19 11  8.6 7610.4 ms 403.7 ms 31.8  13.4

SID    Name            RID        Duration    #N    #F  Avg TPS    Min RT    Avg RT    Stdev    90p RT   99p RT   Max RT     Max RTT   MQS AQS  Max WT    Avg WT   CPU  JMM
0   HTTP-b
    (u:16 t:2)  0                 30.0     1437     0  47.900     29.9 ms  36.821 ms  6.6 ms   42.1 ms  55.2 ms  189.9 ms  29 18:51:37 3   1.7 225.5 ms  46.6 ms  5.2   13.4
                1                 30.0     1441     0  48.033     29.5 ms  36.929 ms  6.7 ms   42.2 ms  59.0 ms  196.6 ms  29 18:52:13 3   1.7 196.6 ms  46.4 ms  21.3  13.4
                2                 30.0     1274     2  42.467     30.0 ms  39.977 ms  33.1 ms  44.7 ms  77.8 ms  1135.6 ms 29 18:52:49 3   1.7 1062.9 ms 54.2 ms  11.7  13.4
                [3.HTTP-posts]    0:01:30  832      1  9.244      29.9 ms  37.127 ms  5.2 ms   42.9 ms  57.5 ms  80.4 ms   29 18:52:34 3   1.7 1062.9 ms 54.2 ms  21.3  13.4
                [4.HTTP-comments] 0:01:30  832      0  9.244      30.1 ms  37.577 ms  9.6 ms   42.9 ms  61.5 ms  196.6 ms  29 18:52:13 3   1.7 1062.9 ms 54.2 ms  21.3  13.4
                [5.HTTP-albums]   0:01:30  828      0  9.200      29.5 ms  37.425 ms  8.7 ms   42.6 ms  68.4 ms  204.5 ms  29 18:52:29 3   1.7 1062.9 ms 54.2 ms  21.3  13.4
                [6.HTTP-photos]   0:01:30  831      1  9.233      30.2 ms  37.457 ms  5.7 ms   43.4 ms  62.5 ms  83.4 ms   29 18:52:45 3   1.7 1062.9 ms 54.2 ms  21.3  13.4
                [7.HTTP-todos]    0:01:30  829      0  9.211      30.1 ms  39.551 ms  40.3 ms  43.7 ms  73.9 ms  1135.6 ms 29 18:52:49 3   1.7 1062.9 ms 54.2 ms  21.3  13.4
                                  0:01:30  4152     2  46.133     29.5 ms  37.827 ms  19.2 ms  43.1 ms  63.6 ms  1135.6 ms 29 18:52:49 3   1.7 1062.9 ms 54.2 ms  21.3  13.4

SID    Name            RID        Duration    #N    #F  Avg TPS    Min RT    Avg RT    Stdev    90p RT   99p RT   Max RT     Max RTT   MQS AQS  Max WT    Avg WT   CPU  JMM
0   Shutdown
    (u:16 t:2)  0                 1.608    16       0  9.950      100.2 ms 100.320 ms 0.2 ms   100.6 ms 100.8 ms 100.8 ms  29 18:53:00 1   0.9 0.1 ms    0.1 ms   4.4   13.4
                [99]              0:00:01  16       0  9.950      100.2 ms 100.320 ms 0.2 ms   100.6 ms 100.9 ms 100.8 ms  29 18:53:00 1   0.9 0.1 ms    0.1 ms   4.4   13.4
                                  0:00:01  16       0  9.950      100.2 ms 100.320 ms 0.2 ms   100.6 ms 100.9 ms 100.8 ms  29 18:53:00 1   0.9 0.1 ms    0.1 ms   4.4   13.4
----

== Example Benchmark Configuration

=== Default Test Configuration

[source,json]
----
{
     "static": {
        "description": "Micro-benchmarks",
        "output_filename": "benchmark_output.json",
        "report_filename": "benchmark_report.html",
        "user_class": "user.http.HttpUser",
        "user_params": {
            "url": "https://jsonplaceholder.typicode.com",
            "urlx": "http://localhost:7070"
        },
        "user_actions": {
            "0": "start",
            "1": "DELAY-6ms",
            "2": "DELAY-14ms",
            "3": "HTTP-posts",
            "4": "HTTP-comments",
            "5": "HTTP-albums",
            "6": "HTTP-photos",
            "7": "HTTP-todos",
            "8": "login",
            "9": "noop",
            "10": "DELAY-10ms",
            "99": "stop"
        }
    },
    "contexts": [
        {
            "name": "Scenario-1",
            "enabled": true,
            "num_users": 16,
            "num_threads": 2
        },
        {
            "name": "Scenario-2",
            "enabled": false,
            "num_users": 32,
            "num_threads": 4
        }
    ],
    "benchmarks": [
        {
            "name": "Init",
            "enabled": true,
            "time": {
                "prewarmup_duration": 0,
                "warmup_duration": 0,
                "benchmark_duration": 0,
                "benchmark_duration_repeat_count": 1
            },
            "throughput_rate": 0.0,
            "work_in_progress": 1,
            "actions": [
                {
                    "id": 0
                },
                {
                    "id": 8
                }
            ]
        },
        {
            "name": "Max TPS-a",
            "enabled": true,
            "time": {
                "prewarmup_duration": 15,
                "warmup_duration": 30,
                "benchmark_duration": 30,
                "benchmark_duration_repeat_count": 3
            },
            "throughput_rate": 0.0,
            "work_in_progress": -1,
            "actions": [
                {
                    "id": 9
                }
            ]
        },
        {
            "name": "Max TPS-b",
            "enabled": true,
            "time": {
                "prewarmup_duration": 15,
                "warmup_duration": 30,
                "benchmark_duration": 30,
                "benchmark_duration_repeat_count": 3
            },
            "throughput_rate": 1000000.0,
            "work_in_progress": -1,
            "actions": [
                {
                    "id": 9
                }
            ]
        },
        {
            "name": "Fixed TPS-a",
            "enabled": true,
            "time": {
                "prewarmup_duration": 15,
                "warmup_duration": 15,
                "benchmark_duration": 30,
                "benchmark_duration_repeat_count": 4
            },
            "throughput_rate": 100.0,
            "work_in_progress": 0,
            "actions": [
                {
                    "id": 1,
                    "weight": 25
                },
                {
                    "id": 2,
                    "weight": 75
                }
            ]
        },
        {
            "name": "Fixed TPS-b",
            "enabled": true,
            "time": {
                "prewarmup_duration": 15,
                "warmup_duration": 15,
                "benchmark_duration": 30,
                "benchmark_duration_repeat_count": 4
            },
            "throughput_rate": 100.0,
            "work_in_progress": 0,
            "actions": [
                {
                    "id": 10
                }
            ]
        },
        {
            "name": "HTTP-a",
            "enabled": true,
            "time": {
                "prewarmup_duration": 15,
                "warmup_duration": 15,
                "benchmark_duration": 30,
                "benchmark_duration_repeat_count": 3
            },
            "throughput_rate": 0.0,
            "work_in_progress": -1,
            "actions": [
                {
                    "id": 3
                },
                {
                    "id": 4
                },
                {
                    "id": 5
                },
                {
                    "id": 6
                },
                {
                    "id": 7
                }
            ]
        },
        {
            "name": "HTTP-b",
            "enabled": true,
            "time": {
                "prewarmup_duration": 15,
                "warmup_duration": 15,
                "benchmark_duration": 30,
                "benchmark_duration_repeat_count": 3
            },
            "throughput_rate": 1250.0,
            "work_in_progress": 0,
            "actions": [
                {
                    "id": 3
                },
                {
                    "id": 4
                },
                {
                    "id": 5
                },
                {
                    "id": 6
                },
                {
                    "id": 7
                }
            ]
        },
        {
            "name": "Shutdown",
            "enabled": true,
            "time": {
                "prewarmup_duration": 0,
                "warmup_duration": 0,
                "benchmark_duration": 0,
                "benchmark_duration_repeat_count": 1
            },
            "throughput_rate": 0.0,
            "work_in_progress": 1,
            "actions": [
                {
                    "id": 99
                }
            ]
        }
    ]
}
----

== Running Standalone Benchmarks

=== Publish Tulip Runtime

Build the Tulip runtime (tulip-runtime-jvm.jar) and publish it to the local Maven ~/.m2 folder.

.Linux
----
$ ./publish.sh
----

.Command output
----
~/.m2/repository/org/tulip/tulip-runtime-jvm/2.0.0-SNAPSHOT/tulip-runtime-jvm-2.0.0-SNAPSHOT-sources.jar
~/.m2/repository/org/tulip/tulip-runtime-jvm/2.0.0-SNAPSHOT/tulip-runtime-jvm-2.0.0-SNAPSHOT.jar
----

=== Standalone Gradle / Kotlin benchmark

This benchmark retrieves the tulip-runtime-jvm.jar file from the local Maven cache.

----
$ cd tulip-standalone/gradle
$ ./go_bench.sh
----

== Appendix

=== Coordinated Omission

Tulip compensates for back-pressure from the system under test and adjusts the measured service times accordingly:

* https://redhatperf.github.io/post/coordinated-omission/

=== Kotlin Books

* https://www.manning.com/books/kotlin-in-action[Kotlin in Action, 1st Edition]
* https://www.manning.com/books/kotlin-in-action-second-edition[Kotlin in Action, 2nd Edition]
* https://typealias.com/start/[Kotlin: An Illustrated Guide]

=== Performance Engineering

* "Stop Rate Limiting! Capacity Management Done Right" by Jon Moore
** https://www.youtube.com/watch?v=m64SWl9bfvk

== License

[source,text]
----
Copyright 2024 Werner Fouch√©

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
----