package io.github.wfouche.tulip.report;

/// usr/bin/env jbang "$0" "$@" ; exit $?

// spotless:off
//DEPS com.google.code.gson:gson:2.11.0
//DEPS org.hdrhistogram:HdrHistogram:2.2.2
//DEPS org.python:jython-standalone:2.7.4
//JAVA 21
// spotless:on

import java.util.Base64;
import org.python.util.PythonInterpreter;

public class report2_py {

  public static String mainScriptTextBase64 =
      "ZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBwcmludF9mdW5jdGlvbgppbXBvcnQganNvbgppbXBvcnQgc3lzCmltcG9ydCBjb20uZ29vZ2xlLmdzb24uSnNvblBhcnNlciBhcyBKc29uUGFyc2VyCmltcG9ydCBvcwpmcm9tIGNvbGxlY3Rpb25zIGltcG9ydCBPcmRlcmVkRGljdAoKIyAvLy8gamJhbmcKIyByZXF1aXJlcy1qeXRob24gPSAiPT0yLjcuNCIKIyByZXF1aXJlcy1qYXZhID0gIj49MjEiCiMgZGVwZW5kZW5jaWVzID0gWwojICAgImNvbS5nb29nbGUuY29kZS5nc29uOmdzb246Mi4xMS4wIiwKIyAgICJvcmcuaGRyaGlzdG9ncmFtOkhkckhpc3RvZ3JhbToyLjIuMiIKIyBdCiMgW3B5dGhvbi1qdm1dCiMgICBkZWJ1ZyA9IGZhbHNlCiMgLy8vCgpoZWFkZXIgPSAnJyc9IF9fREVTQ1JJUFRJT05fXwo6dG9jOiBsZWZ0CjpzZWN0bnVtczoKOmRpYWdyYW0tc2VydmVyLXVybDogaHR0cHM6Ly9rcm9raS5pby8KOmRpYWdyYW0tc2VydmVyLXR5cGU6IGtyb2tpX2lvCgpGaWxlbmFtZTo6CiAgX19DT05GSUdfRklMRU5BTUVfXwoKPT0gQWN0aW9ucwoKWyVoZWFkZXIsY29scz0iMWEsNGEiXQp8PT09CnwgaWQgfCB2YWx1ZQonJycKCmRlZiBjcmVhdGVSZXBvcnQoZmlsZW5hbWUpOgoKICAgIGRlZiBwcmludGYocyk6CiAgICAgICAgcmVwb3J0X2ZoLndyaXRlKHMpCgogICAgZGVmIGFjdGlvbk5hbWUocyk6CiAgICAgICAgcmV0dXJuIHMuc3BsaXQoIiwiKVswXS5zdHJpcCgpCgogICAgZGVmIGFjdGlvbkRlc2Mocyk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gcy5zcGxpdCgiLCIpWzFdLnN0cmlwKCkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiAiIgoKICAgIGRlZiBnZW5lcmF0ZV90YWJsZTEoZSk6CiAgICAgICAgcHJpbnRmKCJ8ICoiICsgZSArICIqXG4iKQogICAgICAgIHByaW50ZigifFxuIikKICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDNhIl1cbicpCiAgICAgICAgcHJpbnRmKCchPT09XG4nKQogICAgICAgIHByaW50ZignISBpZCAhIHZhbHVlIFxuJykKICAgICAgICBmb3IgayBpbiBqYlsnYWN0aW9ucyddW2VdLmtleXMoKToKICAgICAgICAgICAgcHJpbnRmKCchIConICsgayArICcqICcpCiAgICAgICAgICAgIHByaW50ZignISAnICsgc3RyKGpiWydhY3Rpb25zJ11bZV1ba10pICsgJ1xuJykKICAgICAgICBwcmludGYoJyE9PT1cbicpCgogICAgZGVmIGdlbmVyYXRlX3RhYmxlMihlKToKICAgICAgICBwcmludGYoInwgKiIgKyBlICsgIipcbiIpCiAgICAgICAgcHJpbnRmKCJ8XG4iKQogICAgICAgIHByaW50ZignWyVoZWFkZXIsY29scz0iMmEsMmEsNGEiXVxuJykKICAgICAgICBwcmludGYoJyE9PT1cbicpCiAgICAgICAgcHJpbnRmKCchIGlkICEgdmFsdWUgISBkZXNjcmlwdGlvblxuJykKICAgICAgICBmb3IgayBpbiBqYlsnYWN0aW9ucyddW2VdLmtleXMoKToKICAgICAgICAgICAgcHJpbnRmKCchIConICsgayArICcqICcpCiAgICAgICAgICAgIHByaW50ZignISAnICsgYWN0aW9uTmFtZShzdHIoamJbJ2FjdGlvbnMnXVtlXVtrXSkpKQogICAgICAgICAgICBwcmludGYoJyEgJyArIGFjdGlvbkRlc2Moc3RyKGpiWydhY3Rpb25zJ11bZV1ba10pKSArICdcbicpCiAgICAgICAgcHJpbnRmKCchPT09XG4nKQoKICAgIGRlZiBnZW5lcmF0ZV93b3JrZmxvdygpOgogICAgICAgIGRpYWdJZCA9IC0xCiAgICAgICAgZGVmIG5hbWVfdG9faWQocyk6CiAgICAgICAgICAgIGlmIHMgaW4gJy0nOgogICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgcmV0dXJuIGludChzKQogICAgICAgIGRlZiBhY3Rpb25fbmFtZShzKToKICAgICAgICAgICAgaWYgcyBpbiBqYlsnYWN0aW9ucyddWyd1c2VyX2FjdGlvbnMnXS5rZXlzKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uTmFtZShqYlsnYWN0aW9ucyddWyd1c2VyX2FjdGlvbnMnXVtzXSkKICAgICAgICAgICAgcmV0dXJuICc8dW5rbm93bj4nCgogICAgICAgICNwcmludChqYi5rZXlzKCkpCiAgICAgICAgI3ByaW50KGpiWyJ3b3JrZmxvd3MiXS5rZXlzKCkpCiAgICAgICAgZm9yIHduIGluIGpiWyJ3b3JrZmxvd3MiXS5rZXlzKCk6CiAgICAgICAgICAgIGRpYWdJZCArPSAxCiAgICAgICAgICAgIHByaW50ZigiXG4iKQogICAgICAgICAgICBwcmludGYoIltbJXNdXVxuIiUod24pKQogICAgICAgICAgICBwcmludGYoIj09PSAiICsgIiVzXG4iJSh3bikpCiAgICAgICAgICAgIHByaW50ZigiXG4iKQogICAgICAgICAgICBwcmludGYoJ1slaGVhZGVyLGNvbHM9IjFhLDFhIl1cbicpCiAgICAgICAgICAgIHByaW50ZignfD09PVxuJykKICAgICAgICAgICAgcHJpbnRmKCd8IFdvcmtmbG93IERpYWdyYW0gfCBTcGVjaWZpY2F0aW9uXG4nKQogICAgICAgICAgICBwcmludGYoJ3wnKQogICAgICAgICAgICBwcmludGYoIltwbGFudHVtbCx3ZmQlZCxzdmddIiUoZGlhZ0lkKSArICdcbicpCiAgICAgICAgICAgIHByaW50ZignLS0tLVxuJykKICAgICAgICAgICAgcHJpbnRmKCdAc3RhcnR1bWxcbicpCiAgICAgICAgICAgICNwcmludGYoJ3RpdGxlICVzXG4nJSh3bikpCiAgICAgICAgICAgIGZvciBzbmFtZSBpbiBqYlsnd29ya2Zsb3dzJ11bd25dLmtleXMoKToKICAgICAgICAgICAgICAgIGlmIHNuYW1lIGluIFsnLSddOgogICAgICAgICAgICAgICAgICAgIHByaW50Zignc3RhdGUgIi0iIGFzIEEwXG4nKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBzaWQgPSBpbnQoc25hbWUpCiAgICAgICAgICAgICAgICBwcmludGYoJ3N0YXRlICJBY3Rpb24gJWQiIGFzIEElZFxuJyUoc2lkLHNpZCkpCiAgICAgICAgICAgICAgICBwcmludGYoJ0ElZDogPCVzPlxuJyUoc2lkLGFjdGlvbl9uYW1lKHNuYW1lKSkpCiAgICAgICAgICAgICAgICBwcmludGYoJ1xuJykKICAgICAgICAgICAgZm9yIHNuYW1lIGluIGpiWyd3b3JrZmxvd3MnXVt3bl0ua2V5cygpOgogICAgICAgICAgICAgICAgaWYgc25hbWUgaW4gWycqJ106CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGlmIHNuYW1lIGluIFsnLSddOgogICAgICAgICAgICAgICAgICAgIG1pZCA9IDAKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbWlkID0gaW50KHNuYW1lKQogICAgICAgICAgICAgICAgZm9yIGsgaW4gamJbJ3dvcmtmbG93cyddW3duXVtzbmFtZV0ua2V5cygpOgogICAgICAgICAgICAgICAgICAgIG5pZCA9IG5hbWVfdG9faWQoaykKICAgICAgICAgICAgICAgICAgICBmdiA9IGpiWyd3b3JrZmxvd3MnXVt3bl1bc25hbWVdW2tdCiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCdBJWQgLS0+IEElZDogJS4zZlxuJyUobWlkLG5pZCxmdikpCiAgICAgICAgICAgIHByaW50ZignQGVuZHVtbFxuJykKICAgICAgICAgICAgcHJpbnRmKCctLS0tXG4nKQogICAgICAgICAgICBwcmludGYoJ3wgXG4nKQogICAgICAgICAgICBwcmludGYoJ1tzb3VyY2UsanNvbl1cbicpCiAgICAgICAgICAgIHByaW50ZignLS0tLVxuJykKICAgICAgICAgICAgcHJpbnRmKCclc1xuJyUoanNvbi5kdW1wcyhqYlsnd29ya2Zsb3dzJ11bd25dLCBpbmRlbnQ9NCkpKQogICAgICAgICAgICBwcmludGYoJy0tLS1cbicpCiAgICAgICAgICAgIHByaW50ZignfD09PVxuJykKCiAgICAjcHJpbnQoIlxuQ29uZmlnIGZpbGVuYW1lID0gIiArIGZpbGVuYW1lKQoKICAgICMgLmpzb25jIC0+IC5hZG9jCiAgICBmX2V4dCA9IG9zLnBhdGguc3BsaXRleHQoZmlsZW5hbWUpWzFdCiAgICByZXBvcnRfZm4gPSBmaWxlbmFtZVs6LWxlbihmX2V4dCldKyIuYWRvYyIKICAgIHJlcG9ydF9maCA9IG9wZW4ocmVwb3J0X2ZuLCAidysiKQoKICAgICMgUmVtb3ZlIGFsbCBKU09OQyBjb21tZW50cyBmcm9tIHRoZSBKU09OCiAgICBzZiA9IG9wZW4oZmlsZW5hbWUsJ3InKS5yZWFkKCkKICAgIGdzb25Kc29uVHJlZSA9IEpzb25QYXJzZXIucGFyc2VTdHJpbmcoc2YpCiAgICBqc29uV2l0aG91dENvbW1lbnRzID0gZ3Nvbkpzb25UcmVlLnRvU3RyaW5nKCkKICAgIGdzb25Kc29uVHJlZSA9IE5vbmUKCiAgICAjIFJlc3RvcmUgSlNPTiBmcm9tIFN0cmluZwogICAgamIgPSBqc29uLmxvYWRzKGpzb25XaXRob3V0Q29tbWVudHMsIG9iamVjdF9wYWlyc19ob29rPU9yZGVyZWREaWN0KQogICAganNvbldpdGhvdXRDb21tZW50cyA9IE5vbmUKCiAgICAjIHByaW50IGhlYWRlcgogICAgcHJpbnRmKGhlYWRlci5yZXBsYWNlKCJfX0NPTkZJR19GSUxFTkFNRV9fIiwgZmlsZW5hbWUpLnJlcGxhY2UoIl9fREVTQ1JJUFRJT05fXyIsIGpiWydhY3Rpb25zJ11bJ2Rlc2NyaXB0aW9uJ10pKQoKICAgICMgQWN0aW9ucwogICAgZm9yIGUgaW4gamJbJ2FjdGlvbnMnXS5rZXlzKCk6CiAgICAgICAgaWYgZSBpbiBbJ3VzZXJfcGFyYW1zJywgJ3VzZXJfYWN0aW9ucyddOgogICAgICAgICAgICBpZiBlID09ICd1c2VyX3BhcmFtcyc6CiAgICAgICAgICAgICAgICBnZW5lcmF0ZV90YWJsZTEoZSkKICAgICAgICAgICAgaWYgZSA9PSAndXNlcl9hY3Rpb25zJzoKICAgICAgICAgICAgICAgIGdlbmVyYXRlX3RhYmxlMihlKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgICMgfCAqZGVzY3JpcHRpb24qCiAgICAgICAgIyB8IE1pY3JvLWJlbmNobWFya3MKICAgICAgICBwcmludGYoInwgKiIgKyBlICsgJypcbicpCiAgICAgICAgcHJpbnRmKCJ8ICIgKyBqYlsnYWN0aW9ucyddW2VdICsgJ1xuJykKICAgIHByaW50ZigifD09PSIgKyAnXG4nKQoKICAgICMgV29ya2Zsb3dzCiAgICBpZiAid29ya2Zsb3dzIiBpbiBqYi5rZXlzKCk6CiAgICAgICAgcHJpbnRmKCJcbiIpCiAgICAgICAgcHJpbnRmKCI9PSBXb3JrZmxvd3MgXG4iKQogICAgICAgIGdlbmVyYXRlX3dvcmtmbG93KCkKCiAgICAjIEJlbmNobWFya3MgRGF0YQogICAgcHJpbnRmKCJcbiIpCiAgICBwcmludGYoIj09IEJlbmNobWFya3NcbiIpCiAgICBmb3IgayBpbiBqYlsnYmVuY2htYXJrcyddLmtleXMoKToKICAgICAgICBiID0gamJbJ2JlbmNobWFya3MnXVtrXQogICAgICAgIHByaW50ZigiXG4iKQogICAgICAgIHByaW50ZignPT09ICVzJyUoaykgKyAnXG4nKQogICAgICAgIHByaW50ZigiXG4iKQogICAgICAgIHByaW50ZignWyVoZWFkZXIsY29scz0iMWEsMmEiXVxuJykKICAgICAgICBwcmludGYoInw9PT1cbiIpCiAgICAgICAgcHJpbnRmKCJ8IGlkIHwgdmFsdWVcbiIpCiAgICAgICAgIyBlbmFibGVkCiAgICAgICAgaWYgImVuYWJsZWQiIGluIGIua2V5cygpOgogICAgICAgICAgICBwcmludGYoJ3wgKmVuYWJsZWQqIHwgJXNcbiclKGJbImVuYWJsZWQiXSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRmKCd8ICplbmFibGVkKiB8IFRydWVcbicpCiAgICAgICAgIyBhcHNfcmF0ZQogICAgICAgIGlmICJhcHNfcmF0ZSIgaW4gYi5rZXlzKCk6CiAgICAgICAgICAgIHByaW50ZignfCAqYXBzX3JhdGUqIHwgJS4xZlxuJyUoYlsiYXBzX3JhdGUiXSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRmKCd8ICphcHNfcmF0ZSogfCAwLjBcbicpCiAgICAgICAgIyB3b3JrZXJfdGhyZWFkX3F1ZXVlX3NpemUKICAgICAgICBpZiAid29ya2VyX3RocmVhZF9xdWV1ZV9zaXplIiBpbiBiLmtleXMoKToKICAgICAgICAgICAgcHJpbnRmKCd8ICp3b3JrZXJfdGhyZWFkX3F1ZXVlX3NpemUqIHwgJWRcbiclKGJbIndvcmtlcl90aHJlYWRfcXVldWVfc2l6ZSJdKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludGYoJ3wgKndvcmtlcl90aHJlYWRfcXVldWVfc2l6ZSogfCAwXG4nKQogICAgICAgICMgd29ya2Zsb3cKICAgICAgICBpZiAic2NlbmFyaW9fd29ya2Zsb3ciIGluIGIua2V5cygpOgogICAgICAgICAgICB3b3JrZmxvd19pc19kZWZpbmVkID0gYlsic2NlbmFyaW9fd29ya2Zsb3ciXSBpbiBqYlsid29ya2Zsb3dzIl0ua2V5cygpCiAgICAgICAgICAgIGlmIHdvcmtmbG93X2lzX2RlZmluZWQ6CiAgICAgICAgICAgICAgICBwcmludGYoJ3wgKnNjZW5hcmlvX3dvcmtmbG93KiB8IDw8JXM+PlxuJyUoYlsic2NlbmFyaW9fd29ya2Zsb3ciXSkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludGYoJ3wgKnNjZW5hcmlvX3dvcmtmbG93KiB8IEVycm9yLCBzY2VuYXJpb193b3JrZmxvdyAqJXMqIGlzIG5vdCBkZWZpbmVkXG4nJShiWyJzY2VuYXJpb193b3JrZmxvdyJdKSkKICAgICAgICBlbGlmICJzY2VuYXJpb19hY3Rpb25zIiBpbiBiLmtleXMoKToKICAgICAgICAgICAgcHJpbnRmKCd8ICpzY2VuYXJpb19hY3Rpb25zKiBcbicpCiAgICAgICAgICAgIHByaW50ZignfCBcbicpCiAgICAgICAgICAgIHByaW50ZignWyVoZWFkZXIsY29scz0iMWEsMmEiXVxuJykKICAgICAgICAgICAgcHJpbnRmKCchPT09XG4nKQogICAgICAgICAgICBwcmludGYoJyEgaWQgISB3ZWlnaHQgXG4nKQogICAgICAgICAgICBmb3IgYSBpbiBiWyJzY2VuYXJpb19hY3Rpb25zIl06CiAgICAgICAgICAgICAgICBwcmludGYoJyEgJWRcbiclKGFbImlkIl0pKQogICAgICAgICAgICAgICAgaWYgIndlaWdodCIgaW4gYS5rZXlzKCk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCchICVkIFxuJyUoYVsid2VpZ2h0Il0pKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludGYoJyEgLSBcbicpCiAgICAgICAgICAgIHByaW50ZignIT09PVxuJykKICAgICAgICAjIHRpbWUKICAgICAgICBpZiAidGltZSIgaW4gYi5rZXlzKCk6CiAgICAgICAgICAgIHByaW50ZignfCAqdGltZSogXG4nKQogICAgICAgICAgICBwcmludGYoJ3wgXG4nKQogICAgICAgICAgICBwcmludGYoJ1slbm9oZWFkZXIsY29scz0iMmEsMWEiXVxuJykKICAgICAgICAgICAgcHJpbnRmKCchPT09XG4nKQogICAgICAgICAgICAjcHJpbnRmKCchIGlkICEgdmFsdWUgXG4nKQogICAgICAgICAgICBmb3IgayBpbiBiWyJ0aW1lIl0ua2V5cygpOgogICAgICAgICAgICAgICAgcHJpbnRmKCchIColcypcbiclKGspKQogICAgICAgICAgICAgICAgcHJpbnRmKCchICVkIHNlY29uZHNcbiclKGJbInRpbWUiXVtrXSkpCiAgICAgICAgICAgIHByaW50ZignIT09PVxuJykKCiAgICAgICAgcHJpbnRmKCJ8PT09XG4iKQoKICAgICMgQ29udGV4dCBEYXRhCiAgICBwcmludGYoIlxuIikKICAgIHByaW50ZigiPT0gQ29udGV4dHNcbiIpCiAgICBwcmludGYoIlxuIikKCiAgICBmb3IgayBpbiBqYlsnY29udGV4dHMnXS5rZXlzKCk6CiAgICAgICAgYyA9IGpiWydjb250ZXh0cyddW2tdCiAgICAgICAgcHJpbnRmKCc9PT0gJXMnJShrKSArICdcbicpCiAgICAgICAgcHJpbnRmKCdcbicpCiAgICAgICAgcHJpbnRmKCdbJWhlYWRlcixjb2xzPSIxYSwyYSJdXG4nKQogICAgICAgIHByaW50ZignfD09PVxuJykKICAgICAgICBwcmludGYoJ3wgaWQgfCB2YWx1ZSBcbicpCiAgICAgICAgaWYgImVuYWJsZWQiIGluIGMua2V5cygpOgogICAgICAgICAgICBwcmludGYoJ3wgKmVuYWJsZWQqIHwgJXNcbiclKGNbImVuYWJsZWQiXSkpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRmKCd8ICplbmFibGVkKiB8IFRydWVcbicpCiAgICAgICAgcHJpbnRmKCd8ICpudW1fdXNlcnMqICAgfCAlZFxuJyUoY1sibnVtX3VzZXJzIl0pKQogICAgICAgIHByaW50ZignfCAqbnVtX3RocmVhZHMqIHwgJWRcbiclKGNbIm51bV90aHJlYWRzIl0pKQogICAgICAgIHByaW50ZigifD09PVxuIikKCiAgICByZXBvcnRfZmguY2xvc2UoKQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIGlmIGxlbihzeXMuYXJndikgPj0gMjoKICAgICAgICBmaWxlbmFtZSA9IHN5cy5hcmd2WzFdCiAgICAgICAgY3JlYXRlUmVwb3J0KGZpbGVuYW1lKQo=";

  public static void main(String... args) {
    String mainScriptFilename = "report2.py";
    String mainScript = "";
    String pythonArgsScript = "";
    for (String arg : args) {
      if (pythonArgsScript.length() == 0) {
        if (!arg.equals(mainScriptFilename)) {
          pythonArgsScript += "'" + mainScriptFilename + "', ";
        }
      } else {
        pythonArgsScript += ", ";
      }
      pythonArgsScript += "'" + arg + "'";
    }
    if (pythonArgsScript.length() == 0) {
      pythonArgsScript = "'" + mainScriptFilename + "'";
    }
    pythonArgsScript = "import sys; sys.argv = [" + pythonArgsScript + "]";
    {
      byte[] decodedBytes = Base64.getDecoder().decode(mainScriptTextBase64);
      String text = new String(decodedBytes);
      mainScript = text;
    }
    {
      // create Python interpreter object
      PythonInterpreter pyInterp = new PythonInterpreter();
      // initialize command-line args
      pyInterp.exec(pythonArgsScript);
      // run script
      pyInterp.exec(mainScript);
    }
  }
}
